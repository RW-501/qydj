<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Events | QYDJ</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="/styles/style.css" />
</head>
<body class="bg-gray-50 text-gray-900">

  <!-- Header -->
  <div id="header-placeholder"></div>

  <!-- Page Title -->
  <section class="text-center py-12 bg-black text-white">
    <h1 class="text-4xl font-bold">QYDJ Events</h1>
    <p class="mt-2 text-lg">See what's coming up — or relive past memories!</p>
  </section>

  <!-- Filter Tabs -->
  <div class="flex justify-center my-6 gap-4">
    <button class="tab-btn btn" data-tab="upcoming">Upcoming Events</button>
    <button class="tab-btn btn-outline" data-tab="past">Past Events</button>
  </div>

  <!-- Event Sections -->
  <section id="events-container" class="container grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 py-6">
    <!-- Event Cards Injected Here -->
  </section>

  <!-- Optional Footer -->
  <div id="footer-placeholder"></div>

  <!-- Script to load header/footer -->
  <script>
    fetch('/components/header.html')
      .then(res => res.text())
      .then(data => document.getElementById('header-placeholder').innerHTML = data);
    fetch('/components/footer.html')
      .then(res => res.text())
      .then(data => document.getElementById('footer-placeholder').innerHTML = data);
  </script>

  <!-- Firebase + Event Loader -->
  <script type="module">
    import { db } from './firebase.js';
    import {
      collection, query, where, orderBy, getDocs
    } from 'https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js';

    const container = document.getElementById('events-container');
    const tabs = document.querySelectorAll('.tab-btn');

    async function loadEvents(type = 'upcoming') {
      container.innerHTML = '';
      const now = new Date();
      const q = query(
        collection(db, 'events'),
        where('status', '==', type),
        orderBy('date', type === 'upcoming' ? 'asc' : 'desc')
      );
      const snapshot = await getDocs(q);
      if (snapshot.empty) {
        container.innerHTML = '<p class="col-span-full text-center text-gray-500">No events found.</p>';
        return;
      }

      snapshot.forEach(doc => {
        const e = doc.data();
        const date = new Date(e.date).toLocaleDateString();
        const time = new Date(e.date).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <img src="${e.bannerImage}" alt="${e.title}" class="w-full h-48 object-cover">
          <div class="p-4">
            <h2 class="text-xl font-bold mb-2">${e.title}</h2>
            <p class="text-sm text-gray-600 mb-1">${date} • ${time}</p>
            <p class="text-sm text-gray-600 mb-4">${e.location}</p>
            <div class="flex justify-between items-center">
              <a href="${e.rsvpLink || '#'}" target="_blank" class="btn text-sm">RSVP</a>
              <div class="flex gap-2">
                <a href="https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(location.href)}" target="_blank" title="Share on Facebook">
                  <img src="/icons/facebook.svg" class="w-5 h-5" />
                </a>
                <a href="https://twitter.com/intent/tweet?url=${encodeURIComponent(location.href)}&text=${encodeURIComponent(e.title)}" target="_blank" title="Share on Twitter">
                  <img src="/icons/twitter.svg" class="w-5 h-5" />
                </a>
                <a href="https://api.whatsapp.com/send?text=${encodeURIComponent(e.title + ' - ' + location.href)}" target="_blank" title="Share on WhatsApp">
                  <img src="/icons/whatsapp.svg" class="w-5 h-5" />
                </a>
                <a href="${e.instagramLink || '#'}" target="_blank" title="Instagram">
                  <img src="/icons/instagram.svg" class="w-5 h-5" />
                </a>
              </div>
            </div>
          </div>
        `;
        container.appendChild(card);
      });
    }

    tabs.forEach(btn => {
      btn.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('btn', 'btn-outline'));
        btn.classList.add('btn');
        const tab = btn.getAttribute('data-tab');
        loadEvents(tab);
      });
    });

    // Load default
    loadEvents('upcoming');
  </script>

</body>
</html>
